pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
-- tictactoe1
-- by apa64

-- todo:
-- title screen with instructions
-- function(s) to manage the field
-- game state:
--   select_cell
--     --> check_valid
--     --> check_victory
--     --> change_player
--       --> select_cell

-- cursor cell
local cursor_x = 2
local cursor_y = 2

-- width/height of a cell
local cell_width = 32
-- playing field
local field = {}
-- field coords
-- 16,16 48,16 80,16
-- 16,48 48,48 80,48
-- 16,80 48,80 80,80
-- top right of first cell
local field_x0 = 16
local field_y0 = 16
-- top right of last cell
local field_x1 = field_x0 + 2*cell_width
local field_y1 = field_y0 + 2*cell_width

function _init()
  -- init 3x3 field with coords
  for x = field_y0, field_y1, cell_width do
    row = {}
    for y = field_x0, field_x1, cell_width do
      local cell = {}
      cell.x = x
      cell.y = y
      cell.mark = nil -- nil, x, o
      add(row, cell)
    end
    add(field, row)
  end
end

-->8
-- ###################### update

function _update()
  -- move cursor
  if btnp(0) then
    cursor_x = (cursor_x - 1) % 4
    if (cursor_x == 0) cursor_x = 3
  end
  if btnp(1) then
    cursor_x = (cursor_x + 1) % 4
    if (cursor_x == 0) cursor_x = 1
  end
  if btnp(2) then
    cursor_y = (cursor_y - 1) % 4
    if (cursor_y == 0) cursor_y = 3
  end
  if btnp(3) then
    cursor_y = (cursor_y + 1) % 4
    if (cursor_y == 0) cursor_y = 1
  end
  -- select the coords under box
  if (btnp(4)) then
    field[cursor_x][cursor_y]["mark"] = "o"
  end
  if (btnp(5)) then
    field[cursor_x][cursor_y]["mark"] = "x"
  end
end

-->8
-- ######################## draw

function _draw()
  cls(5)
  -- playing field
  map(0, 0, 16, 16, 12, 12)
  -- ui texts
  print("player: x", 48, 7, 7)
  print("wins: x 00 - o 00", 30, 116, 7)

  draw_field()
  draw_cursor()
  -- debug
  print("cx:"..cursor_x..",cy:"..cursor_y..",mark:"..tostr(field[cursor_x][cursor_y]["mark"]), 0, 122, 14)
end

-- draws the cursor box
function draw_cursor()
  -- current cell x,y
  local x = field[cursor_x][cursor_y]["x"]
  local y = field[cursor_x][cursor_y]["y"]
  rect(x + 1, y + 1, x + cell_width - 2, y + cell_width - 2, 7)
end

function draw_field()
  foreach(field, function(row)
    foreach(row, function(cell)
      if (cell.mark == "x") then
        -- sprite x: 56,0
        sspr(56, 0, 8, 8, cell.x + 8, cell.y + 8, 16, 16)
      elseif (cell.mark == "o") then
        -- sprite o: 64,0
        sspr(64, 0, 8, 8, cell.x + 8, cell.y + 8, 16, 16)
      end
    end)
  end
  )
end

__gfx__
00000000000000000000000000066000000000000006600000066000700000070077770000000000000000000000000000000000000000000000000000000000
00000000000000000000000000066000000000000006600000066000070000700700007000000000000000000000000000000000000000000000000000000000
00700700000000000000000000066000000000000005650000565000007007007000000700000000000000000000000000000000000000000000000000000000
00077000000005666666666600066000665000000000666666660000000770007000000700000000000000000000000000000000000000000000000000000000
00077000000066666666666600066000666600000000056666500000000770007000000700000000000000000000000000000000000000000000000000000000
00700700000565000000000000066000005650000000000000000000007007007000000700000000000000000000000000000000000000000000000000000000
00000000000660000000000000066000000660000000000000000000070000700700007000000000000000000000000000000000000000000000000000000000
00000000000660000000000000066000000660000000000000000000700000070077770000000000000000000000000000000000000000000000000000000000
__map__
0102020401020204010202040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000303000003030000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000303000003030000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0502020605020206050202060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020401020204010202040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000303000003030000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000303000003030000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0502020605020206050202060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020401020204010202040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000303000003030000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000303000003030000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0502020605020206050202060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
